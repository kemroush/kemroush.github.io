<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auto monitor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background-color: #0d1117;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='75' height='43.3' viewBox='0 0 75 43.3'%3E%3Cpath d='M25,0 L50,0 L62.5,21.65 L50,43.3 L25,43.3 L12.5,21.65 Z M0,21.65 L12.5,21.65 M62.5,21.65 L75,21.65' fill='none' stroke='%23ffffff' stroke-opacity='0.03' stroke-width='0.5'/%3E%3C/svg%3E");
      background-size: 75px 43.3px;
      color: #e6edf3;
      min-height: 100vh;
      padding: 2.5rem 1.5rem;
    }

    .page {
      max-width: 680px;
      margin: 0 auto;
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .back, .run-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #8b949e;
      text-decoration: none;
      font-size: 0.82rem;
      transition: color 0.2s;
    }
    .back:hover, .run-btn:hover { color: #f0883e; }

    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 1.5rem;
    }

    /* ── Day navigation ── */
    .day-nav {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
    }

    .nav-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: #161b22;
      border: none;
      color: #8b949e;
      cursor: pointer;
      transition: color 0.2s, background 0.2s;
      flex-shrink: 0;
    }
    .nav-btn:hover:not(:disabled) {
      color: #f0883e;
      background: #1f2937;
    }
    .nav-btn:disabled {
      opacity: 0.25;
      cursor: default;
    }

    .day-info { flex: 1; }

    .day-label {
      font-size: 1.05rem;
      font-weight: 600;
      color: #e6edf3;
    }

    .day-meta {
      font-size: 0.78rem;
      color: #8b949e;
      margin-top: 2px;
    }
    .day-meta .accent { color: #f0883e; }

    .filter {
      font-size: 0.78rem;
      color: #484f58;
      margin-bottom: 1.75rem;
    }

    /* ── Car cards ── */
    .car-card {
      display: flex;
      gap: 0.9rem;
      align-items: stretch;
      background: #161b22;
      border-radius: 12px;
      padding: 0;
      margin-bottom: 0.6rem;
      text-decoration: none;
      color: inherit;
      overflow: hidden;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .car-card:hover {
      background: #1f2937;
      box-shadow: 0 0 20px rgba(240, 136, 62, 0.1);
    }

    .car-thumb {
      width: 120px;
      flex-shrink: 0;
      background: #0d1117;
    }
    .car-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .car-body {
      flex: 1;
      padding: 0.85rem 1rem 0.85rem 0;
      min-width: 0;
    }

    .car-top {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 1rem;
      margin-bottom: 0.35rem;
    }
    .car-title {
      font-weight: 600;
      color: #f0883e;
      font-size: 0.9rem;
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .car-price {
      font-weight: 700;
      color: #e6edf3;
      white-space: nowrap;
      font-size: 0.9rem;
    }
    .car-details {
      font-size: 0.78rem;
      color: #8b949e;
    }
    .car-time {
      font-size: 0.7rem;
      color: #30363d;
      margin-top: 0.3rem;
    }

    .state-msg {
      color: #8b949e;
      font-size: 0.88rem;
      text-align: center;
      padding: 3rem 0;
    }

    /* ── Brand filter ── */
    .brand-filter {
      display: flex;
      gap: 0.4rem;
      margin-bottom: 1rem;
    }

    .brand-btn {
      padding: 0.3rem 0.85rem;
      border-radius: 20px;
      border: 1px solid #30363d;
      background: transparent;
      color: #8b949e;
      font-size: 0.78rem;
      font-family: inherit;
      cursor: pointer;
      transition: color 0.2s, border-color 0.2s, background 0.2s;
    }
    .brand-btn:hover {
      color: #e6edf3;
      border-color: #8b949e;
    }
    .brand-btn.active {
      background: #f0883e;
      border-color: #f0883e;
      color: #0d1117;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="top-bar">
      <a href="index.html" class="back">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 5l-7 7 7 7"/>
        </svg>
        kemroush
      </a>
      <a href="https://github.com/kemroush/kemroush.github.io/actions/workflows/auto-monitor.yml" class="run-btn" target="_blank" rel="noopener" title="Spustit ručně">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="5 3 19 12 5 21 5 3"/>
        </svg>
        Spustit
      </a>
    </div>

    <h1>Auto monitor</h1>

    <div class="day-nav">
      <button class="nav-btn" id="prev-btn" title="Starší den">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>

      <div class="day-info">
        <div class="day-label" id="day-label">–</div>
        <div class="day-meta" id="day-meta"></div>
      </div>

      <button class="nav-btn" id="next-btn" title="Novější den">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>

    <p class="filter">BMW, Mercedes & Mini · Automat · 2022+ · do 100 000 km · 300–750 000 Kč · sauto.cz</p>

    <div class="brand-filter">
      <button class="brand-btn active" data-brand="all">Vše</button>
      <button class="brand-btn" data-brand="bmw">BMW</button>
      <button class="brand-btn" data-brand="mercedes">Mercedes</button>
      <button class="brand-btn" data-brand="mini">Mini</button>
    </div>

    <div id="cars-list"><p class="state-msg">Načítám...</p></div>
  </div>

  <script>
    let days       = [];   // [{key, count, updated}, ...] nejnovější první
    let idx        = 0;
    let allCars    = [];
    let activeBrand = 'all';

    function formatDay(key) {
      const [y, m, d] = key.split('-');
      return `${parseInt(d)}. ${parseInt(m)}. ${y}`;
    }

    function relativeLabel(key) {
      const tz = 'Europe/Prague';
      const todayKey     = new Date().toLocaleDateString('sv-SE', { timeZone: tz });
      const yesterdayKey = new Date(Date.now() - 86400000).toLocaleDateString('sv-SE', { timeZone: tz });
      if (key === todayKey)     return 'dnes';
      if (key === yesterdayKey) return 'včera';
      return null;
    }

    function renderDayHeader(i) {
      const day = days[i];
      document.getElementById('day-label').textContent = formatDay(day.key);

      const rel     = relativeLabel(day.key);
      const relPart = rel ? `<span class="accent">${rel}</span> · ` : '';
      const count   = day.count != null ? `${day.count} inzerátů` : '';
      const updated = day.updated ? ` · aktualizováno ${day.updated}` : '';
      document.getElementById('day-meta').innerHTML = relPart + count + updated;

      document.getElementById('prev-btn').disabled = i >= days.length - 1;
      document.getElementById('next-btn').disabled = i <= 0;
    }

    async function showDay(i) {
      idx = i;
      renderDayHeader(i);

      const list = document.getElementById('cars-list');
      list.innerHTML = '<p class="state-msg">Načítám...</p>';

      try {
        const res = await fetch(`data/cars_${days[i].key}.json`);
        allCars   = await res.json();
        renderCars();
      } catch {
        list.innerHTML = '<p class="state-msg">Nepodařilo se načíst data.</p>';
      }
    }

    function filteredCars() {
      if (activeBrand === 'all') return allCars;
      return allCars.filter(c => {
        const t = c.title.toLowerCase();
        if (activeBrand === 'bmw')      return t.startsWith('bmw');
        if (activeBrand === 'mercedes') return t.startsWith('mercedes');
        if (activeBrand === 'mini')     return t.startsWith('mini');
        return true;
      });
    }

    function renderCars() {
      const cars = filteredCars();
      const list = document.getElementById('cars-list');
      if (!cars.length) {
        list.innerHTML = '<p class="state-msg">Žádná auta pro tento filtr.</p>';
        return;
      }
      list.innerHTML = cars.map(c => `
        <a href="${c.link}" class="car-card" target="_blank" rel="noopener">
          ${c.image ? `<div class="car-thumb"><img src="${c.image}" alt="" loading="lazy"></div>` : ''}
          <div class="car-body">
            <div class="car-top">
              <span class="car-title">${c.title}</span>
              <span class="car-price">${c.price}</span>
            </div>
            <div class="car-details">${c.details}</div>
            ${c.found_at ? `<div class="car-time">nalezeno ${c.found_at}</div>` : ''}
          </div>
        </a>
      `).join('');
    }

    document.getElementById('prev-btn').addEventListener('click', () => showDay(idx + 1));
    document.getElementById('next-btn').addEventListener('click', () => showDay(idx - 1));

    document.querySelectorAll('.brand-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        activeBrand = btn.dataset.brand;
        document.querySelectorAll('.brand-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderCars();
      });
    });

    // Keyboard navigation
    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft'  && idx < days.length - 1) showDay(idx + 1);
      if (e.key === 'ArrowRight' && idx > 0)              showDay(idx - 1);
    });

    async function init() {
      try {
        const res   = await fetch('data/index.json');
        const index = await res.json();
        days = index.days;
        if (days.length) showDay(0);
        else document.getElementById('cars-list').innerHTML =
          '<p class="state-msg">Zatím žádné záznamy.</p>';
      } catch {
        document.getElementById('cars-list').innerHTML =
          '<p class="state-msg">Nepodařilo se načíst index.</p>';
      }
    }

    init();
  </script>
</body>
</html>
